# network

## ë„¤íŠ¸ì›Œí¬ì— ëŒ€í•œ ë©˜íƒˆ ëª¨ë¸ scaffolding

í•œ ì»´í“¨í„°ì™€ ë‹¤ë¥¸ ì»´í“¨í„°ê°€ ì†Œí†µí•˜ëŠ” ê²ƒ. í•´ë‹¹ ì†Œí†µì˜ ê·œì¹™ì„ í”„ë¡œí† ì½œì´ë¼ í•œë‹¤.  
text protocolì¸ http, smtp, ircëŠ” ë””ë²„ê¹…í•˜ê¸° í¸í•˜ê³  í…ìŠ¤íŠ¸ ì“°ëŠ” ê·¸ëŒ€ë¡œ ë‹¤ë£° ìˆ˜ ìˆë‹¤.  
í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ í”„ë¡œí† ì½œì€ binary protocolì´ê³  ì´ë“¤ì„ ë””ë²„ê¹…í•˜ê¸° ìœ„í•´ì„œëŠ” wireshark, termshark, tcpdumpì™€ ê°™ì€ íŒ¨í‚· ë¶„ì„ ë„êµ¬ê°€ í•„ìš”í•˜ë‹¤.

ì¢…ì¢… 80(http), 443(https)ëŠ” ìƒëµë˜ì§€ë§Œ ìš°ë¦¬ê°€ ë‹¤ë¥¸ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, ip:port ì ì–´ ìš”ì²­ì„ ë³´ë‚¸ë‹¤. ì´ëŠ” ìš”ì²­ ì„œë²„ì—ì„œ ë‹¤ë¥¸ ì„œë²„ì— ì ‘ì´‰í•  ë•Œ ìµœì†Œí•œ ipì™€ portê°€ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ëŠ” http ë¿ë§Œì´ ì•„ë‹ˆë¼ ipv4 ì‹œê°„ìœ¼ë¡œ í†µì‹ í•˜ëŠ” í”„ë¡œí† ì½œì€ ë‹¤ ê·¸ë ‡ë‹¤. TDP/UDPë„ ipì™€ portê°€ í•„ìš”í•˜ë‹¤.

```text
resp, err := http.Get("https://jsonplaceholder.typicode.com/todos/1") // golang
axios.get("http://localhost:3000") // javascript
```

ìš”ì²­ì„ ë°›ì€ ì„œë²„(ì‘ë‹µ ì„œë²„)ëŠ” ëª©ì ì§€ê°€ ì„œë²„ì— ë§ëŠ”ì§€, í¬íŠ¸ê°€ ì—´ë ¤ ìˆëŠ”ì§€ ë“±ì„ ì²´í¬í•˜ëŠ” ë“± TCP/IP ê³„ì¸µì„ ì˜¬ë¼ê°€ë©° deencapsulationì„ í†µí•´ ìš”ì²­ ì„œë²„ì—ì„œ ë³´ë‚¸ ì •ë³´ë¥¼ í•´ì„í•˜ê³  ë°›ì•„ë“¤ì¸ë‹¤.

ê·¸ ê³¼ì •ì„ ëª¨ë‘ êµ¬ì²´ì ìœ¼ë¡œ ì ì„ ìˆœ ì—†ê² ì§€ë§Œ **ìš”ì²­ ì„œë²„ê°€ ë³´ë‚¸ byte ë©ì–´ë¦¬ë¥¼ NIC ë‚´ì˜ bufferì— ìŒ“ì•„ë’€ë‹¤ê°€ ì‘ë‹µ ì„œë²„ê°€ ë¹¼ê°„ë‹¤**.

> ğŸ’¡ **NIC(ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤Â ì¹´ë“œ)**  
> 2ê³„ì¸µ(ë°ì´í„° ë§í¬ ê³„ì¸µ)ì˜ ì¥ì¹˜ì…ë‹ˆë‹¤. ì»´í“¨í„°ë¥¼ ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°í•˜ê¸° ìœ„í•œ í•˜ë“œì›¨ì–´ ì¥ì¹˜. ë³„ëª…ì´ ë§ìŠµë‹ˆë‹¤. ëœ ì¹´ë“œ, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì»¨íŠ¸ë¡¤, ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ ë“±ë“±. ì—¬ëŸ¬ ì¼ì„ ë‹´ë‹¹í•˜ê³  ìˆì§€ë§Œ ìµœëŒ€í•œ ë‹¨ìˆœí•˜ê²Œ ìš”ì•½í•˜ìë©´ 'NICëŠ” ë¬¼ë¦¬ì  ì£¼ì†Œì¸ MAC ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆê³ , ëª©ì ì§€ MAC ì£¼ì†Œê°€ ë‹¤ë¥¸ íŒ¨í‚·ì€ ê·¸ëƒ¥ ë²„ë¦°ë‹¤'ê³  ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.  
> https://darrengwon.tistory.com/1306?category=907881

ë³´í†µ ì„œë²„ì™€ ì„œë²„ì˜ ê³§ì¥ í†µì‹ í•˜ëŠ” ê²½ìš°ë„ ìˆì§€ë§Œ ipv4ê°€ ë¶€ì¡±í•œ í˜„ ìƒí™©ì—ì„œëŠ” gateway ì—­í• ì„ í•˜ëŠ” public ip(ê³µì¸ ip)ê°€ ì•ì— ìˆê³  ê·¸ ë‚´ë¶€ì— private ip(ì‚¬ì„¤ ip)ê°€ ëŒ€ë¶€ë¶„ì˜ ìƒí™©ì´ë‹¤.

```mermaid
flowchart LR

A(ì™¸ë¶€) <--> B(gateway, NAT, public ip ë³€í™˜) <--> C(ì‹¤ ì„œë²„, private ip)
```

- ëŒ€í‘œì ì¸ ê²½ìš°ë¡œ NAT ì¥ë¹„ì— public ipê°€ ìˆê³  NATì„ ê²½ìœ í•˜ì—¬ egressí•˜ëŠ” ë‚´ë¶€ ì„œë²„ë“¤ì˜ ipëŠ” private ipë¡œ ê°ì¶°ì ¸ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ êµ¬ì„±.
- AWS ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ìë©´ private subnetì— ì¡´ì¬í•˜ëŠ” ì‚¬ì„¤ ëŒ€ì—­ ipì˜ ì„œë²„ë“¤ì´ public subnetì— ì¡´ì¬í•˜ëŠ” NATì„ í†µí•´ public IPë¡œ ë³€í™˜ë˜ì–´ ì™¸ë¶€ì™€ í†µì‹ í•˜ê²Œ ë˜ì–´ egress[outbound]ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, ì™¸ë¶€ ì¸í„°ë„·ì—ì„œ ingress[inbound]ëŠ” ì•ˆë˜ëŠ” ìƒí™©

ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ gatewayë¥¼ í†µí•´ ì§„í–‰ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ íë¦„ ìˆœì„œë¥¼ ìŠì–´ë³´ì.
private ipì¸ ìš°ë¦¬ ì„œë²„ê°€ gatewayë¥¼ ê±°ì³ naver.comì— ë‹¿ëŠ”ë‹¤ê³  í•´ë³´ì.

**[egress(private ip ì‹¤ ì„œë²„â†’ gateway â†’ naver)]**

- private ipì´ 10.0.0.1, 357 í¬íŠ¸ì—ì„œ ìš”ì²­ì„ ë³´ëƒˆë‹¤.
- NATì´ í•´ë‹¹ private ipë¥¼ public ipë¡œ ë³€í™˜í•˜ê³ , private portë¥¼ public portë¡œ ë³€ê²½í•˜ëŠ” port-forwardingì´ ì§„í–‰ëœë‹¤.
  - gatewayëŠ” ì´ì œ ì¶œë°œì§€(ì‹¤ì„œë²„)ê³¼ ë„ì°©ì§€ì˜ ip, portë¥¼ ì•Œê³  ì´ë¥¼ **NAT table**ì— ê¸°ë¡í•œë‹¤.
- naver ì„œë²„ëŠ” NATì˜ ì£¼ì†Œë¥¼ ìš”ì²­ ì„œë²„ë¥¼ ê±°ì¹œ ìš”ì²­ì„ ë°›ì•„ë“¤ì¸ë‹¤.
  - naverëŠ” ì¸ì‹í•˜ê³  ê·¸ ë°°í›„ì— ìˆëŠ” private ipì˜ ì‹¤ ì„œë²„ëŠ” ëª¨ë¥¸ë‹¤.

**[ingress(naver â†’ gateway â†’ private ip ì‹¤ ì„œë²„)]**

- naverê°€ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ gatewayë¡œ ë³´ë‚¸ë‹¤.
- gatewayëŠ” NAT tableì„ ë³´ê³  ì‹¤ ì„œë²„ì—ê²Œ íŒ¨í‚·ì„ ë³´ë‚¸ë‹¤.
